---
layout: post
title: 通过ROP绕过NX
excerpt: "sploitfun系列教程之2.1 ROP"
categories: [sploitfun系列教程]
comments: true
---

漏洞代码
```c
//vuln.c
#include <stdio.h>
#include <string.h>

int main(int argc, char* argv[]) {
 char buf[256];
 seteuid(getuid()); /* Temporarily drop privileges */
 strcpy(buf,argv[1]);
 printf("%s",buf);
 fflush(stdout);
 return 0;
}
```
编译
```
gcc -fno-stack-protector -g -o vuln vuln.c
gcc -fno-stack-protector -g -o vuln vuln.c -m32
chmod 777 vuln
```
查看保护措施
```bash
python
>>> from pwn import *
>>> print ELF('vuln').checksec()
[*] '/root/sploitfun/vuln'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)

```
通过`ROPgadget --binary vuln | less`查找代码片段

根据这个网站进行寄存器配置 http://syscalls.kernelgrok.com/

配置成这样
```
 _____________________________
| eax | ebx | ecx | edx | int |
|-----------------------------|
| 0x0b| sh  | 0   | 0   | 0x80|
|_____|_____|_____|_____|_____|
 
```