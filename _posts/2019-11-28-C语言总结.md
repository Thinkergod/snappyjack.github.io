---
layout: post
title: C语言总结
excerpt: "pwn中使用的C语言总结"
categories: [知识总结]
comments: true
---

## Write和Read

**STDIN_FILENO：接收键盘的输入**

**STDOUT_FILENO：向屏幕输出**

接收用户在屏幕上输入的数据，并在屏幕上输出（要求使用read和wirte实现），用户输入quit就退出程序。

```
graph LR
键盘-->|输入|程序
程序-->|输出|屏幕
```

代码
```c
#include <stdio.h>
#include <string.h>
#include <unistd.h>

int main(int argc, char *args[]) {
    char buf_read[1024];
    char buf_write[1024];

    while (1) {
        memset(buf_read, 0, sizeof(buf_read));// 将buf_read全部设为0
        memset(buf_write, 0, sizeof(buf_write));

        char input_message[100] = "input some words : ";
        write(STDOUT_FILENO, input_message, sizeof(input_message));
        read(STDIN_FILENO, buf_read, sizeof(buf_read));// 读取用户的键盘输入信息
        if (strncmp(buf_read, "quit", 4) == 0) {
            break;
        }
        strcpy(buf_write, buf_read);
        char output_message[100] = "output some words : ";
        write(STDOUT_FILENO, output_message, sizeof(output_message));
        write(STDOUT_FILENO, buf_write, strlen(buf_write));// 将信息显示在屏幕上
    }
    return 0;
}
```
编译
```
gcc main.c -o main
```

最后的结果
```
./main 
input some words : 123
output some words : 123
input some words : 123
output some words : 123
input some words : 434
output some words : 434
input some words : 33434
output some words : 33434
```

## atoi函数
将字符串转换为数字类型
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
    int n;
    char *str = "12345.67";
    n = atoi(str);
    printf("n=%d\n",n);//%d要求输入的数字类型
    return 0;
}
```

## setbuf函数
C 库函数` int setvbuf(FILE *stream, char *buffer, int mode, size_t size) `定义流 stream 应如何缓冲。

```c
#include <stdio.h>

int main()
{

   char buff[1024];

   memset( buff, '\0', sizeof( buff ));

   fprintf(stdout, "启用全缓冲\n");
   setvbuf(stdout, buff, _IOFBF, 1024);

   fprintf(stdout, "这里是 runoob.com\n");
   fprintf(stdout, "该输出将保存到 buff\n");
   fflush( stdout );

   fprintf(stdout, "这将在编程时出现\n");
   fprintf(stdout, "最后休眠五秒钟\n");

   sleep(5);

   return(0);
}
```
让我们编译并运行上面的程序，这将产生以下结果。在这里，程序把缓冲输出保存到 buff，直到首次调用 fflush() 为止，然后开始缓冲输出，最后休眠 5 秒钟。它会在程序结束之前，发送剩余的输出到 STDOUT。
```
启用全缓冲
这里是 runoob.com
该输出将保存到 buff
这将在编程时出现
最后休眠五秒钟
```